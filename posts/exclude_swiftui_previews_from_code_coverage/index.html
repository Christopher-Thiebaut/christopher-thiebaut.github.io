<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"/><meta property="og:site_name" content="christopherthiebaut.com"/><link rel="canonical" href="http://christopherthiebaut.com/posts/exclude_swiftui_previews_from_code_coverage"/><meta name="twitter:url" content="http://christopherthiebaut.com/posts/exclude_swiftui_previews_from_code_coverage"/><meta property="og:url" content="http://christopherthiebaut.com/posts/exclude_swiftui_previews_from_code_coverage"/><title>How to exclude SwiftUI Previews From Code Coverage Percentage | christopherthiebaut.com</title><meta name="twitter:title" content="How to exclude SwiftUI Previews From Code Coverage Percentage | christopherthiebaut.com"/><meta property="og:title" content="How to exclude SwiftUI Previews From Code Coverage Percentage | christopherthiebaut.com"/><meta name="description" content="How to exclude SwiftUI Previews From Code Coverage Percentage"/><meta name="twitter:description" content="How to exclude SwiftUI Previews From Code Coverage Percentage"/><meta property="og:description" content="How to exclude SwiftUI Previews From Code Coverage Percentage"/><meta name="twitter:card" content="summary"/><link rel="stylesheet" href="/styles.css" type="text/css"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><link rel="shortcut icon" href="/images/favicon.png" type="image/png"/><link rel="alternate" href="/feed.rss" type="application/rss+xml" title="Subscribe to christopherthiebaut.com"/></head><body class="item-page"><header><div class="wrapper"><a class="site-name" href="/">christopherthiebaut.com</a><nav><ul><li><a class="selected" href="/posts">Posts</a></li><li><a href="/about">About</a></li></ul></nav></div></header><div class="wrapper"><article><div class="content"><h1>How to exclude SwiftUI Previews From Code Coverage Percentage</h1><p>TL;DR: Create a new scheme and compiler flag for your tests.</p><h2>THE PROBLEM:</h2><p>SwiftUI previews are great and can give you fantastic iteration speed when changing your app’s views. But what about the test coverage that gives you a high level of confidence to iterate quickly on your app itself? While you can test SwiftUI views <a href="https://nalexn.github.io/swiftui-unit-testing/">by digging into their internals</a> (not recommended as those tests may break in future SwiftUI versions) or with high level XCUI tests, you should not spend time unit testing SwiftUI previews because they’re not part of your app’s code.</p><p>The fact that SwiftUI previews generally are defined inline in the file with the view is great for development speed, but starts to become a problem if you use Xcode’s code coverage reports to track and ensure that you’re maintaining a high level of test coverage for your project. SwiftUI Previews show up as uncovered code, and suddenly you no longer expect to see code coverage reported at or near 100% and it becomes easier to let code coverage slip for actual production code. Alternatively, you may waste time digging in to find what code is uncovered — and repeatedly find out that it’s just previews instead of “real” code.</p><h2>THE SOLUTION:</h2><p>Fortunately, there’s a solution and it’s quick and easy. We just have to create a new build configuration for our tests that does not build the previews. So we start of with something like this:</p><img src="/low_test_coverage.png" alt="image of a project with 79.5% test coverage"/><p>Since this (relatively simple) app was created with TDD, the reported test coverage is relatively good, but deceptively low due to SwiftUI previews.</p><p>To create a new configuration, go to the <code>Info</code> tab of your project settings and duplicate the <code>Debug</code> configuration.</p><img src="/duplicate_debug_configuration.gif" alt="GIF showing duplicating the debug configuration"/><p>Believe it or not, you’re already almost done. Next, we need to add an active compilation condition (a compiler flag to go along with the new scheme.</p><img src="/create_active_compilation_condition.gif" alt="GIF showing creating an active compilation condition"/><p>Now, set the new build configuration as the configuration for your tests:</p><img src="/set_build_configuration_for_tests.gif" alt="GIF showing how to set build configuration for tests"/><p>At this point, all you have left to do is surround your SwiftUI previews with the same <code>#if DEBUG</code> compiler directives that were the default when SwiftUI was brand new (back then, it was because the compiler wasn’t quite so good at optimizing them out of release builds). Alternatively, you could surround them with <code>#if !TESTING</code>. Either way, it’s important to make sure you have at least one application level test (like an XCUITest) that ensures you can’t use these compiler directives to exclude any production code without your test build failing.</p><p>For example:</p><pre><code><span class="preprocessing">#if DEBUG</span>
<span class="keyword">struct</span> RestartOverlay_Previews: <span class="type">PreviewProvider</span> {
    <span class="keyword">static var</span> previews: <span class="keyword">some</span> <span class="type">View</span> {
        <span class="type">Group</span> {
            <span class="type">RestartOverlay</span>(gameEnd: .<span class="dotAccess">draw</span>, restart: {})
                .<span class="call">border</span>(<span class="type">Color</span>.<span class="property">orange</span>, width: <span class="number">2</span>)
            <span class="type">RestartOverlay</span>(gameEnd: .<span class="call">winner</span>(.<span class="dotAccess">o</span>), restart: {})
                .<span class="call">border</span>(<span class="type">Color</span>.<span class="property">orange</span>, width: <span class="number">2</span>)
            <span class="type">RestartOverlay</span>(gameEnd: .<span class="call">winner</span>(.<span class="dotAccess">x</span>), restart: {})
                .<span class="call">border</span>(<span class="type">Color</span>.<span class="property">orange</span>, width: <span class="number">2</span>)
        }
    }
}
<span class="preprocessing">#endif</span>
</code></pre><p>Thanks for reading, I hope this was helpful and informative.</p></div><span>Tagged with: </span><ul class="tag-list"><li><a href="/tags/developer-tools">Developer Tools</a></li><li><a href="/tags/swift">Swift</a></li><li><a href="/tags/swiftui">SwiftUI</a></li></ul></article></div><footer><p>Generated using <a href="https://github.com/johnsundell/publish">Publish</a></p><p><a href="/feed.rss">RSS feed</a></p></footer></body></html>